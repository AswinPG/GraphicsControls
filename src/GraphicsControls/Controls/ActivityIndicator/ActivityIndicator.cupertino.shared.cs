using System.Graphics;
using GraphicsControls.Extensions;
using Xamarin.Forms;

namespace GraphicsControls
{
    public partial class ActivityIndicator
    {
        float _cupertinoActivityIndicatorAngle;

        float CupertinoActivityIndicatorAngle
        {
            get { return _cupertinoActivityIndicatorAngle; }
            set
            {
                _cupertinoActivityIndicatorAngle = value;
                InvalidateDraw();
            }
        }

        void DrawCupertinoActivityIndicator(ICanvas canvas, RectangleF dirtyRect)
        {
            canvas.SaveState();

            canvas.Scale(0.75f, 0.75f);

            var vBuilder = new PathBuilder();
            var path =
                vBuilder.BuildPath(
                    "M16,23.353012C16.551999,23.353013,17,23.801012,17,24.353012L17,31.00001C17,31.55201 16.551999,32.00001 16,32.00001 15.447999,32.00001 15,31.55201 15,31.00001L15,24.353012C15,23.801012,15.447999,23.353013,16,23.353012z M11.882349,22.25521C12.043656,22.258505 12.206556,22.300968 12.356859,22.386598 12.835829,22.660613 13.002818,23.271647 12.729836,23.751674L9.4370441,29.525996C9.2520552,29.849014 8.9150772,30.030025 8.5670986,30.030025 8.3991098,30.030025 8.2291203,29.988022 8.0721302,29.899017 7.5931606,29.625001 7.4261713,29.013968 7.6991539,28.533941L10.991945,22.759619C11.180308,22.430288,11.527474,22.247962,11.882349,22.25521z M20.027796,21.917202C20.365566,21.924239,20.691196,22.102265,20.872964,22.415953L24.385011,28.478001C24.661991,28.956001 24.499026,29.566997 24.020995,29.844007 23.864012,29.935987 23.691037,29.978987 23.520992,29.978987 23.176019,29.978987 22.840018,29.8 22.655019,29.479991L19.142972,23.418949C18.865993,22.94095 19.028958,22.328947 19.505951,22.051967 19.670609,21.956745 19.850868,21.913516 20.027796,21.917202z M8.7567263,19.218469C9.1115561,19.207652 9.4607439,19.386006 9.6525459,19.71324 9.9305305,20.189217 9.7705393,20.802187 9.2935658,21.081173L3.5568819,24.437009C3.397891,24.530005 3.2239008,24.574002 3.0529099,24.574003 2.7089291,24.574002 2.3749466,24.397011 2.1889572,24.079026 1.9099731,23.60205 2.0709648,22.99008 2.5469379,22.711094L8.2836218,19.354258C8.4329882,19.267387,8.5954399,19.223385,8.7567263,19.218469z M22.971681,18.948197C23.132897,18.951152,23.295456,18.993068,23.444831,19.07776L29.536846,22.53792C30.016848,22.810932 30.184848,23.421961 29.912848,23.901983 29.728847,24.225998 29.389846,24.408006 29.041845,24.408006 28.874845,24.408006 28.704844,24.366004 28.548844,24.278L22.457829,20.81784C21.976828,20.544827 21.808827,19.933799 22.081828,19.453777 22.268828,19.123762 22.617005,18.941694 22.971681,18.948197z M23.993983,15.00001L30.999997,15.00001C31.551998,15.00001 31.999999,15.448009 31.999999,16.00001 31.999999,16.55201 31.551998,17.00001 30.999997,17.00001L23.993983,17.00001C23.441982,17.00001 22.993981,16.55201 22.993981,16.00001 22.993981,15.448009 23.441982,15.00001 23.993983,15.00001z M1.0000019,15.00001L7.6470232,15.00001C8.1990252,15.00001 8.647027,15.448009 8.647027,16.00001 8.647027,16.55201 8.1990252,17.00001 7.6470232,17.00001L1.0000019,17.00001C0.44799995,17.00001 0,16.55201 0,16.00001 0,15.448009 0.44799995,15.00001 1.0000019,15.00001z M2.9774418,7.592205C3.1385689,7.5952778,3.3011475,7.6374035,3.4508352,7.7223969L9.2308588,11.004143C9.7108612,11.277122 9.8788614,11.888074 9.6068602,12.368037 9.4228592,12.692012 9.0838585,12.873998 8.735857,12.873998 8.5688562,12.873998 8.3988552,12.832001 8.2428551,12.744008L2.4638309,9.4612627C1.98283,9.1882839 1.8148289,8.578331 2.0878296,8.0983677 2.2755184,7.7677059 2.6229649,7.5854464 2.9774418,7.592205z M28.914661,7.4264841C29.269417,7.4156685 29.618884,7.5940228 29.810011,7.921257 30.089013,8.3972349 29.928012,9.0102053 29.452008,9.2891922L23.40496,12.826025C23.245958,12.919021 23.071957,12.963018 22.900956,12.963018 22.556953,12.963018 22.22295,12.786027 22.036949,12.468042 21.757947,11.991065 21.918948,11.379094 22.394952,11.100107L28.441999,7.562274C28.591063,7.4754028,28.753408,7.4314013,28.914661,7.4264841z M8.4513187,2.0223866C8.8060827,2.012846,9.1544075,2.1928482,9.3448553,2.5207958L12.677041,8.2719717C12.954057,8.7499866 12.791048,9.3610048 12.313021,9.6380138 12.156012,9.7300167 11.983003,9.7730179 11.812993,9.7730179 11.467974,9.7730179 11.131955,9.5940123 10.946945,9.274003L7.613759,3.5228271C7.3367434,3.0448112 7.5007524,2.433794 7.9777794,2.1567841 8.1274757,2.070219 8.290062,2.026722 8.4513187,2.0223866z M23.451962,1.9692326C23.613253,1.9726448 23.776271,2.0153179 23.926888,2.1012535 24.40586,2.3742447 24.572851,2.9852276 24.299866,3.4652119L20.829065,9.5510302C20.644076,9.8740206 20.307095,10.055015 19.959115,10.055015 19.791125,10.055015 19.621134,10.013016 19.464143,9.9240189 18.985171,9.6500273 18.81818,9.0390453 19.091165,8.5590601L22.562966,2.4742432C22.750643,2.1442528,23.097123,1.9617271,23.451962,1.9692326z M16,0C16.551999,0,17,0.44800186,17,1.0000038L17,8.0060177C17,8.5580187 16.551999,9.0060196 16,9.0060196 15.447999,9.0060196 15,8.5580187 15,8.0060177L15,1.0000038C15,0.44800186,15.447999,0,16,0z");

            canvas.FillColor = Color.ToGraphicsColor(Application.Current?.RequestedTheme == OSAppTheme.Light ? Material.Color.Gray1 : Material.Color.Gray4);

            float rX = 16.0f;
            float rY = 16.0f;

            if (IsRunning)
                canvas.Rotate(CupertinoActivityIndicatorAngle, rX, rY);
            else
                canvas.Rotate(0, rX, rY);

            canvas.FillPath(path);

            canvas.RestoreState();
        }

        void AnimateCupertinoActivityIndicatorAnimation()
        {
            var startAngle = 0;
            var endAngle = 360;

            var cupertinoActivityIndicatorAngleAnimation = new Animation(v => CupertinoActivityIndicatorAngle = (int)v, startAngle, endAngle, easing: Easing.Linear);
            cupertinoActivityIndicatorAngleAnimation.Commit(this, "CupertinoActivityIndicator", length: 4000, repeat: () => true, finished: (l, c) => cupertinoActivityIndicatorAngleAnimation = null);
        }
    }
}